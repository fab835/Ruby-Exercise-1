<%= form_tag cakes_calculate_cake_path(), method: :post do %>
    <div class="row">
        <div class="col">
            <%= render "recipe"%>
        </div>

        <div class="col">
            <%= render "ingredients"%>
        </div>
    </div>
    <br>
    <div class="d-grid gap-2">
        <button type="submit" class="btn btn-primary">Calculate</button>
    </div>
    <br>
<% end %>

<%= render "result" %>

<script>
    let total_ingredients = document.getElementsByClassName('ingredient_item').length
    let total_recipes = document.getElementsByClassName('recipe_item').length

    add_ingredients_item = () => {
        total_ingredients += 1

        document.getElementById('ingredients').insertAdjacentHTML("beforeend", `<div class="row ingredient_item ingredients-${total_ingredients}"><div class="col"><div class="mb-3"><label class="form-label" for="ingredients_${total_ingredients}_key">name</label><input type="text" name="ingredients[${total_ingredients}][key]" id="ingredients_${total_ingredients}_key" class="form-control"></div></div><div class="col"><div class="mb-3"><label class="form-label" for="ingredients_${total_ingredients}_value">amount</label><input type="number" name="ingredients[${total_ingredients}][value]" id="ingredients_${total_ingredients}_value" class="form-control"></div> </div><div class="col-2 align-self-center"><a class="btn btn-default link-danger" href="javascript:remove_ingredients_item(${total_ingredients})">remove</a></div></div>`);

        return false
    }

    add_recipe_item = () => {
        total_recipes += 1

        document.getElementById('recipe').insertAdjacentHTML("beforeend", `<div class="row recipe_item recipe-${total_recipes}"><div class="col"><div class="mb-3"><label class="form-label" for="recipe_${total_recipes}_key">name</label><input type="text" name="recipe[${total_recipes}][key]" id="recipe_${total_recipes}_key" class="form-control"></div></div><div class="col"><div class="mb-3"><label class="form-label" for="recipe_${total_recipes}_value">amount</label><input type="number" name="recipe[${total_recipes}][value]" id="recipe_${total_recipes}_value" class="form-control"></div> </div><div class="col-2 align-self-center"><a class="btn btn-default link-danger" href="javascript:remove_recipe_item(${total_recipes})">remove</a></div></div>`)
        return false
    }

    remove_ingredients_item = (item_index) => {
        const elements = document.getElementsByClassName(`ingredients-${item_index}`);
        while(elements.length > 0){
            elements[0].parentNode.removeChild(elements[0]);
        }
    }

    remove_recipe_item = (item_index) => {
        const elements = document.getElementsByClassName(`recipe-${item_index}`);
        while(elements.length > 0){
            elements[0].parentNode.removeChild(elements[0]);
        }
    }
</script>

